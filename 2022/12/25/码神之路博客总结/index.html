

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="parent工程pom文件1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&amp;l">
<meta property="og:type" content="article">
<meta property="og:title" content="码神之路博客总结(后端)">
<meta property="og:url" content="http://example.com/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="小約翰">
<meta property="og:description" content="parent工程pom文件1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&amp;l">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/45.jpg">
<meta property="article:published_time" content="2022-12-25T12:16:40.000Z">
<meta property="article:modified_time" content="2022-12-25T13:22:55.714Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/45.jpg">
  
  
  
  <title>码神之路博客总结(后端) - 小約翰</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>小约翰</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/3.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="码神之路博客总结(后端)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-25 20:16" pubdate>
          2022年12月25日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          63k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          525 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">码神之路博客总结(后端)</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="parent工程"><a href="#parent工程" class="headerlink" title="parent工程"></a>parent工程</h3><h4 id="pom文件"><a href="#pom文件" class="headerlink" title="pom文件"></a>pom文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">&lt;?xml</span> <span class="hljs-string">version=&quot;1.0&quot;</span> <span class="hljs-string">encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-string">&lt;project</span> <span class="hljs-string">xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br>         <span class="hljs-string">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>         <span class="hljs-string">xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0</span> <span class="hljs-string">http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br>    <span class="hljs-string">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><br>    <span class="hljs-string">&lt;groupId&gt;com.mszlu&lt;/groupId&gt;</span><br>    <span class="hljs-string">&lt;artifactId&gt;blog-parent&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;modules&gt;</span><br>        <span class="hljs-string">&lt;module&gt;blog-api&lt;/module&gt;</span><br>        <span class="hljs-string">&lt;module&gt;blog-admin&lt;/module&gt;</span><br>    <span class="hljs-string">&lt;/modules&gt;</span><br>    <span class="hljs-string">&lt;packaging&gt;pom&lt;/packaging&gt;</span><br>    <span class="hljs-string">&lt;parent&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;2.5.0&lt;/version&gt;</span><br>        <span class="hljs-string">&lt;relativePath/&gt;</span><br>    <span class="hljs-string">&lt;/parent&gt;</span><br><br>    <span class="hljs-string">&lt;properties&gt;</span><br>        <span class="hljs-string">&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br>        <span class="hljs-string">&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br>        <span class="hljs-string">&lt;java.version&gt;1.8&lt;/java.version&gt;</span><br>    <span class="hljs-string">&lt;/properties&gt;</span><br><br><span class="hljs-string">&lt;!--</span>    <span class="hljs-string">父项目的管理--&gt;</span><br>    <span class="hljs-string">&lt;dependencyManagement&gt;</span><br>    <span class="hljs-string">&lt;dependencies&gt;</span><br><br>            <span class="hljs-string">&lt;dependency&gt;</span><br>                <span class="hljs-string">&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br>                <span class="hljs-string">&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br>                <span class="hljs-string">&lt;version&gt;1.2.76&lt;/version&gt;</span><br>            <span class="hljs-string">&lt;/dependency&gt;</span><br><br>            <span class="hljs-string">&lt;dependency&gt;</span><br>                <span class="hljs-string">&lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br>                <span class="hljs-string">&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br>                <span class="hljs-string">&lt;version&gt;3.2.2&lt;/version&gt;</span><br>            <span class="hljs-string">&lt;/dependency&gt;</span><br><br>            <span class="hljs-string">&lt;dependency&gt;</span><br>                <span class="hljs-string">&lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br>                <span class="hljs-string">&lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br>                <span class="hljs-string">&lt;version&gt;3.4.3&lt;/version&gt;</span><br>            <span class="hljs-string">&lt;/dependency&gt;</span><br>            <span class="hljs-string">&lt;!--</span> <span class="hljs-string">https://mvnrepository.com/artifact/joda-time/joda-time</span> <span class="hljs-string">--&gt;</span><br>            <span class="hljs-string">&lt;dependency&gt;</span><br>                <span class="hljs-string">&lt;groupId&gt;joda-time&lt;/groupId&gt;</span><br>                <span class="hljs-string">&lt;artifactId&gt;joda-time&lt;/artifactId&gt;</span><br>                <span class="hljs-string">&lt;version&gt;2.10.10&lt;/version&gt;</span><br>            <span class="hljs-string">&lt;/dependency&gt;</span><br>        <span class="hljs-string">&lt;/dependencies&gt;</span><br>    <span class="hljs-string">&lt;/dependencyManagement&gt;</span><br>    <span class="hljs-string">&lt;build&gt;</span><br>        <span class="hljs-string">&lt;plugins&gt;</span><br>            <span class="hljs-string">&lt;plugin&gt;</span><br>                <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>                <span class="hljs-string">&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br>            <span class="hljs-string">&lt;/plugin&gt;</span><br>        <span class="hljs-string">&lt;/plugins&gt;</span><br>    <span class="hljs-string">&lt;/build&gt;</span><br><span class="hljs-string">&lt;/project&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225202235178.png" srcset="/img/loading.gif" lazyload alt="image-20221225202235178"></p>
<h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225202259020.png" srcset="/img/loading.gif" lazyload alt="image-20221225202259020"></p>
<h3 id="blog-api-pom"><a href="#blog-api-pom" class="headerlink" title="blog-api (pom)"></a>blog-api (pom)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">&lt;?xml</span> <span class="hljs-string">version=&quot;1.0&quot;</span> <span class="hljs-string">encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-string">&lt;project</span> <span class="hljs-string">xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br>         <span class="hljs-string">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>         <span class="hljs-string">xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0</span> <span class="hljs-string">http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br>    <span class="hljs-string">&lt;parent&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;blog-parent&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;com.mszlu&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/parent&gt;</span><br>    <span class="hljs-string">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><br>    <span class="hljs-string">&lt;artifactId&gt;blog-api&lt;/artifactId&gt;</span><br><span class="hljs-string">&lt;dependencies&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;!--</span> <span class="hljs-string">排除</span> <span class="hljs-string">默认使用的logback</span>  <span class="hljs-string">--&gt;</span><br>        <span class="hljs-string">&lt;exclusions&gt;</span><br>            <span class="hljs-string">&lt;exclusion&gt;</span><br>                <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>                <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br>            <span class="hljs-string">&lt;/exclusion&gt;</span><br>        <span class="hljs-string">&lt;/exclusions&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;!--</span> <span class="hljs-string">log4j2</span> <span class="hljs-string">--&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;scope&gt;test&lt;/scope&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;1.2.76&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;mysql&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;optional&gt;true&lt;/optional&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;3.2.2&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;3.4.3&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;joda-time&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;joda-time&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;2.10.10&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;0.9.1&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;[7.7.0,</span> <span class="hljs-number">7.7</span><span class="hljs-number">.99</span><span class="hljs-string">]&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br>    <span class="hljs-string">&lt;dependency&gt;</span><br>        <span class="hljs-string">&lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;</span><br>        <span class="hljs-string">&lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt;</span><br>        <span class="hljs-string">&lt;version&gt;2.1.1&lt;/version&gt;</span><br>    <span class="hljs-string">&lt;/dependency&gt;</span><br><span class="hljs-string">&lt;!--</span>    <span class="hljs-string">&lt;dependency&gt;--&gt;</span><br><span class="hljs-string">&lt;!--</span>        <span class="hljs-string">&lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;--&gt;</span><br><span class="hljs-string">&lt;!--</span>        <span class="hljs-string">&lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;--&gt;</span><br><span class="hljs-string">&lt;!--</span>        <span class="hljs-string">&lt;version&gt;2.2.0&lt;/version&gt;--&gt;</span><br><span class="hljs-string">&lt;!--</span>    <span class="hljs-string">&lt;/dependency&gt;--&gt;</span><br><span class="hljs-string">&lt;/dependencies&gt;</span><br><span class="hljs-string">&lt;/project&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="application-yaml-文件"><a href="#application-yaml-文件" class="headerlink" title="application.yaml 文件"></a>application.yaml 文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">server.port=8888</span><br><span class="hljs-string">spring.application.name=mszlu_blog</span><br><br><span class="hljs-comment">#rocketmq\u914D\u7F6E</span><br><span class="hljs-comment">#rocketmq.name-server=192.168.200.100:9876</span><br><span class="hljs-comment">#rocketmq.producer.group=blog_group</span><br><br><span class="hljs-comment"># datasource \u5BC6\u7801 root root</span><br><span class="hljs-string">spring.datasource.url=jdbc:mysql://localhost:3306/blog?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimeZone=UTC</span><br><span class="hljs-string">spring.datasource.username=root</span><br><span class="hljs-string">spring.datasource.password=admin123</span><br><span class="hljs-string">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><br><span class="hljs-comment">#spring.profiles.active=prod</span><br><span class="hljs-comment">#mybatis-plus</span><br><span class="hljs-comment">#mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl</span><br><span class="hljs-string">mybatis-plus.global-config.db-config.table-prefix=ms_</span><br><br><span class="hljs-string">spring.redis.host=localhost</span><br><span class="hljs-string">spring.redis.port=6379</span><br><br><span class="hljs-string">spring.servlet.multipart.max-request-size=20MB</span><br><span class="hljs-string">spring.servlet.multipart.max-file-size=2MB</span><br><br><span class="hljs-string">jasypt.encryptor.password=mszlu_blog_$#@wzb_&amp;^%$#</span><br><br><br><span class="hljs-comment">#\uFFFD\uFFFD\u0163\uFFFD\uFFFD\uFFFD\uFFFD</span><br><span class="hljs-string">qiniu.accessKey=11</span><br><span class="hljs-string">qiniu.accessSecretKey=22</span><br></code></pre></td></tr></table></figure>

<h4 id="mapper文件"><a href="#mapper文件" class="headerlink" title="mapper文件"></a>mapper文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-comment">&lt;!--MyBatis配置文件--&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.mszlu.blog.dao.mapper.TagMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- List&lt;Tag&gt; findTagsByArticleId(Long articleId);--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findTagsByArticleId&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;long&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.mszlu.blog.dao.pojo.Tag&quot;</span>&gt;</span><br>        select id,avatar,tag_name as tagName from  ms_tag<br>        where id in<br>        (select tag_id from ms_article_tag where article_id=#&#123;articleId&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- List&lt;Long&gt; findHotsTagIds(int limit);--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findHotsTagIds&quot;</span>  <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Long&quot;</span>&gt;</span><br>        SELECT  tag_id FROM `ms_article_tag` group by tag_id order by count(*) desc limit #&#123;limit&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- List&lt;Tag&gt; findTagsByTagIds(List&lt;Long&gt; tagIds);--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findTagsByTagIds&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.mszlu.blog.dao.pojo.Tag&quot;</span>&gt;</span><br>        select id,tag_name as tagName from ms_tag<br>        where id in<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;tagIds&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;tagId&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>            #&#123;tagId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225202804542.png" srcset="/img/loading.gif" lazyload alt="image-20221225202804542"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">&lt;?xml</span> <span class="hljs-string">version=&quot;1.0&quot;</span> <span class="hljs-string">encoding=&quot;UTF-8&quot;</span> <span class="hljs-string">?&gt;</span><br><span class="hljs-string">&lt;!--MyBatis配置文件--&gt;</span><br><span class="hljs-string">&lt;!DOCTYPE</span> <span class="hljs-string">mapper</span> <span class="hljs-string">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="hljs-string">&gt;</span><br><br><span class="hljs-string">&lt;mapper</span> <span class="hljs-string">namespace=&quot;com.mszlu.blog.dao.mapper.ArticleMapper&quot;&gt;</span><br><br>    <span class="hljs-string">&lt;resultMap</span> <span class="hljs-string">id=&quot;articleMap&quot;</span> <span class="hljs-string">type=&quot;com.mszlu.blog.dao.pojo.Article&quot;&gt;</span><br>        <span class="hljs-string">&lt;id</span> <span class="hljs-string">column=&quot;id&quot;</span> <span class="hljs-string">property=&quot;id&quot;</span> <span class="hljs-string">/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;author_id&quot;</span> <span class="hljs-string">property=&quot;authorId&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;comment_counts&quot;</span> <span class="hljs-string">property=&quot;commentCounts&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;create_date&quot;</span> <span class="hljs-string">property=&quot;createDate&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;summary&quot;</span> <span class="hljs-string">property=&quot;summary&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;title&quot;</span> <span class="hljs-string">property=&quot;title&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;view_counts&quot;</span> <span class="hljs-string">property=&quot;viewCounts&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;weight&quot;</span> <span class="hljs-string">property=&quot;weight&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;body_id&quot;</span> <span class="hljs-string">property=&quot;bodyId&quot;/&gt;</span><br>        <span class="hljs-string">&lt;result</span> <span class="hljs-string">column=&quot;category_id&quot;</span> <span class="hljs-string">property=&quot;categoryId&quot;/&gt;</span><br>    <span class="hljs-string">&lt;/resultMap&gt;</span><br><br>    <span class="hljs-string">&lt;select</span> <span class="hljs-string">id=&quot;listArchives&quot;</span> <span class="hljs-string">resultType=&quot;com.mszlu.blog.dao.dos.Archives&quot;&gt;</span><br>        <span class="hljs-string">select</span> <span class="hljs-string">FROM_UNIXTIME(create_date/1000,&#x27;%Y&#x27;)</span> <span class="hljs-string">as</span> <span class="hljs-string">year,FROM_UNIXTIME(create_date/1000,&#x27;%m&#x27;)</span> <span class="hljs-string">as</span> <span class="hljs-string">month,count(*)</span> <span class="hljs-string">as</span> <span class="hljs-string">count</span> <span class="hljs-string">from</span> <span class="hljs-string">ms_article</span> <span class="hljs-string">group</span> <span class="hljs-string">by</span> <span class="hljs-string">year,month</span><br>    <span class="hljs-string">&lt;/select&gt;</span><br>    <span class="hljs-string">&lt;!--</span>            <span class="hljs-string">Long</span> <span class="hljs-string">categoryId,</span><br>                               <span class="hljs-string">Long</span> <span class="hljs-string">tagId,</span><br>                               <span class="hljs-string">String</span> <span class="hljs-string">year,</span><br>                               <span class="hljs-string">String</span> <span class="hljs-string">month--&gt;</span><br>    <span class="hljs-string">&lt;select</span> <span class="hljs-string">id=&quot;listArticle&quot;</span> <span class="hljs-string">resultMap=&quot;articleMap&quot;&gt;</span><br>        <span class="hljs-string">select</span> <span class="hljs-string">*</span> <span class="hljs-string">from</span> <span class="hljs-string">ms_article</span><br>        <span class="hljs-string">&lt;where&gt;</span><br>            <span class="hljs-number">1</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><br>            <span class="hljs-string">&lt;if</span> <span class="hljs-string">test=&quot;categoryId</span> <span class="hljs-type">!=</span> <span class="hljs-literal">null</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">                and category_id=#&#123;categoryId&#125;</span><br><span class="hljs-string">            &lt;/if&gt;</span><br><span class="hljs-string">            &lt;if test=&quot;</span><span class="hljs-string">tagId</span> <span class="hljs-type">!=</span> <span class="hljs-literal">null</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">                and id in (select article_id from ms_article_tag where tag_id=#&#123;tagId&#125;)</span><br><span class="hljs-string">            &lt;/if&gt;</span><br><span class="hljs-string">            &lt;if test=&quot;</span><span class="hljs-string">year</span> <span class="hljs-type">!=</span> <span class="hljs-literal">null</span> <span class="hljs-string">and</span> <span class="hljs-string">year.length&gt;0</span> <span class="hljs-string">and</span> <span class="hljs-string">month</span> <span class="hljs-type">!=</span> <span class="hljs-literal">null</span> <span class="hljs-string">and</span> <span class="hljs-string">month.length&gt;0&quot;&gt;</span><br>               <span class="hljs-string">and</span> <span class="hljs-string">(FROM_UNIXTIME(create_date/1000,&#x27;%Y&#x27;)</span> <span class="hljs-string">=#&#123;year&#125;</span> <span class="hljs-string">and</span> <span class="hljs-string">FROM_UNIXTIME(create_date/1000,&#x27;%m&#x27;)=#&#123;month&#125;)</span><br>            <span class="hljs-string">&lt;/if&gt;</span><br>        <span class="hljs-string">&lt;/where&gt;</span><br>        <span class="hljs-string">order</span> <span class="hljs-string">by</span> <span class="hljs-string">weight,create_date</span> <span class="hljs-string">desc</span><br>    <span class="hljs-string">&lt;/select&gt;</span><br><br><span class="hljs-string">&lt;/mapper&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225202843248.png" srcset="/img/loading.gif" lazyload alt="image-20221225202843248"></p>
<h4 id="java-文件夹下"><a href="#java-文件夹下" class="headerlink" title="java 文件夹下"></a>java 文件夹下</h4><h4 id="common"><a href="#common" class="headerlink" title="common"></a>common</h4><ol>
<li>aop</li>
</ol>
<h6 id="日志注解"><a href="#日志注解" class="headerlink" title="日志注解"></a>日志注解</h6><p><strong>LogAnntation</strong>(接口)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.common.aop;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><span class="hljs-comment">//Type 代表可以放在类上面 Method 代表可以放在方法上</span><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> LogAnnotation &#123;<br><br>    String <span class="hljs-title function_">module</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    String <span class="hljs-title function_">operator</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>2. </p>
<p><strong>LogAspect(切点)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.common.aop;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.HttpContextUtils;<br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.IpUtils;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><span class="hljs-keyword">import</span> org.aspectj.lang.reflect.MethodSignature;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span> <span class="hljs-comment">//切面 定义了通知和切点的关系</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> &#123;<br><br>    <span class="hljs-meta">@Pointcut(&quot;@annotation(com.mszlu.blog.common.aop.LogAnnotation)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-comment">//环绕通知</span><br>    <span class="hljs-meta">@Around(&quot;pt()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">log</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-comment">//执行方法</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();<br>        <span class="hljs-comment">//执行时长(毫秒)</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - beginTime;<br>        <span class="hljs-comment">//保存日志</span><br>        recordLog(joinPoint, time);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordLog</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();<br>        <span class="hljs-type">LogAnnotation</span> <span class="hljs-variable">logAnnotation</span> <span class="hljs-operator">=</span> method.getAnnotation(LogAnnotation.class);<br>        log.info(<span class="hljs-string">&quot;=====================log start================================&quot;</span>);<br>        log.info(<span class="hljs-string">&quot;module:&#123;&#125;&quot;</span>,logAnnotation.<span class="hljs-keyword">module</span>());<br>        log.info(<span class="hljs-string">&quot;operation:&#123;&#125;&quot;</span>,logAnnotation.operator());<br><br>        <span class="hljs-comment">//请求的方法名</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> joinPoint.getTarget().getClass().getName();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> signature.getName();<br>        log.info(<span class="hljs-string">&quot;request method:&#123;&#125;&quot;</span>,className + <span class="hljs-string">&quot;.&quot;</span> + methodName + <span class="hljs-string">&quot;()&quot;</span>);<br><br><span class="hljs-comment">//        //请求的参数</span><br>        Object[] args = joinPoint.getArgs();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> JSON.toJSONString(args[<span class="hljs-number">0</span>]);<br>        log.info(<span class="hljs-string">&quot;params:&#123;&#125;&quot;</span>,params);<br><br>        <span class="hljs-comment">//获取request 设置IP地址</span><br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpContextUtils.getHttpServletRequest();<br>        log.info(<span class="hljs-string">&quot;ip:&#123;&#125;&quot;</span>, IpUtils.getIpAddr(request));<br><br><br>        log.info(<span class="hljs-string">&quot;excute time : &#123;&#125; ms&quot;</span>,time);<br>        log.info(<span class="hljs-string">&quot;=====================log end================================&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="缓存注解"><a href="#缓存注解" class="headerlink" title="缓存注解"></a>缓存注解</h5><h6 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.common.cache;<br><br><br><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Cache &#123;<br><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">expire</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;<br>    <span class="hljs-comment">//缓存标识 key</span><br>    String <span class="hljs-title function_">name</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h6 id="CacheAspect"><a href="#CacheAspect" class="headerlink" title="CacheAspect"></a>CacheAspect</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.common.cache;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.commons.codec.digest.DigestUtils;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.Signature;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.core.annotation.AliasFor;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.time.Duration;<br><span class="hljs-comment">//aop 定义一个切面，切面定义了切点和通知的关系</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheAspect</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;<br><br>    <span class="hljs-meta">@Pointcut(&quot;@annotation(com.mszlu.blog.common.cache.Cache)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-meta">@Around(&quot;pt()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Signature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> pjp.getSignature();<br>            <span class="hljs-comment">//类名</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> pjp.getTarget().getClass().getSimpleName();<br>            <span class="hljs-comment">//调用的方法名</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> signature.getName();<br><br><br>            Class[] parameterTypes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[pjp.getArgs().length];<br>            Object[] args = pjp.getArgs();<br>            <span class="hljs-comment">//参数</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;args.length; i++) &#123;<br>                <span class="hljs-keyword">if</span>(args[i] != <span class="hljs-literal">null</span>) &#123;<br>                    params += JSON.toJSONString(args[i]);<br>                    parameterTypes[i] = args[i].getClass();<br>                &#125;<span class="hljs-keyword">else</span> &#123;<br>                    parameterTypes[i] = <span class="hljs-literal">null</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(params)) &#123;<br>                <span class="hljs-comment">//加密 以防出现key过长以及字符转义获取不到的情况</span><br>                params = DigestUtils.md5Hex(params);<br>            &#125;<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> pjp.getSignature().getDeclaringType().getMethod(methodName, parameterTypes);<br>            <span class="hljs-comment">//获取Cache注解</span><br>            <span class="hljs-type">Cache</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> method.getAnnotation(Cache.class);<br>            <span class="hljs-comment">//缓存过期时间</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">expire</span> <span class="hljs-operator">=</span> annotation.expire();<br>            <span class="hljs-comment">//缓存名称</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> annotation.name();<br>            <span class="hljs-comment">//先从redis获取</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> name + <span class="hljs-string">&quot;::&quot;</span> + className+<span class="hljs-string">&quot;::&quot;</span>+methodName+<span class="hljs-string">&quot;::&quot;</span>+params;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">redisValue</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(redisKey);<br>            <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(redisValue))&#123;<br>                log.info(<span class="hljs-string">&quot;走了缓存~~~,&#123;&#125;&quot;</span>,redisKey);<br>                <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> JSON.parseObject(redisValue, Result.class);<br>                <span class="hljs-keyword">return</span> result;<br>            &#125;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">proceed</span> <span class="hljs-operator">=</span> pjp.proceed();<br>            redisTemplate.opsForValue().set(redisKey,JSON.toJSONString(proceed), Duration.ofMillis(expire));<br>            log.info(<span class="hljs-string">&quot;存入缓存~~~ &#123;&#125;,&#123;&#125;&quot;</span>,className,methodName);<br>            <span class="hljs-keyword">return</span> proceed;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>            throwable.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.fail(-<span class="hljs-number">999</span>,<span class="hljs-string">&quot;系统错误&quot;</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225204534337.png" srcset="/img/loading.gif" lazyload alt="image-20221225204534337"></p>
<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225204609900.png" srcset="/img/loading.gif" lazyload alt="image-20221225204609900"></p>
<h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><h5 id="MybatisPlusConfig"><a href="#MybatisPlusConfig" class="headerlink" title="MybatisPlusConfig"></a>MybatisPlusConfig</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.config;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;<br><span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@MapperScan(&quot;com.mszlu.blog.dao.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> &#123;<br><br>    <span class="hljs-comment">//分页插件</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>());<br>        <span class="hljs-keyword">return</span> interceptor;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="ThreadPoolConfig"><a href="#ThreadPoolConfig" class="headerlink" title="ThreadPoolConfig"></a>ThreadPoolConfig</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.Executor;<br><span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableAsync</span> <span class="hljs-comment">//开启多线程</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(&quot;taskExecutor&quot;)</span><br>    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">asyncServiceExecutor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();<br>        <span class="hljs-comment">// 设置核心线程数</span><br>        executor.setCorePoolSize(<span class="hljs-number">5</span>);<br>        <span class="hljs-comment">// 设置最大线程数</span><br>        executor.setMaxPoolSize(<span class="hljs-number">20</span>);<br>        <span class="hljs-comment">//配置队列大小</span><br>        executor.setQueueCapacity(Integer.MAX_VALUE);<br>        <span class="hljs-comment">// 设置线程活跃时间（秒）</span><br>        executor.setKeepAliveSeconds(<span class="hljs-number">60</span>);<br>        <span class="hljs-comment">// 设置默认线程名称</span><br>        executor.setThreadNamePrefix(<span class="hljs-string">&quot;码神之路博客项目&quot;</span>);<br>        <span class="hljs-comment">// 等待所有任务结束后再关闭线程池</span><br>        executor.setWaitForTasksToCompleteOnShutdown(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//执行初始化</span><br>        executor.initialize();<br>        <span class="hljs-keyword">return</span> executor;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="WebMVCConfig"><a href="#WebMVCConfig" class="headerlink" title="WebMVCConfig"></a>WebMVCConfig</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.config;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.handler.LoginInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMVCConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> LoginInterceptor loginInterceptor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> &#123;<br><span class="hljs-comment">//        //跨域配置</span><br>        registry.addMapping(<span class="hljs-string">&quot;/**&quot;</span>).allowedOrigins(<span class="hljs-string">&quot;https://blog.mszlu.com&quot;</span>,<span class="hljs-string">&quot;http://blog1.mszlu.com&quot;</span>,<span class="hljs-string">&quot;http://localhost:8080&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        <span class="hljs-comment">//拦截test接口，后续实际遇到需要拦截的接口时，在配置为真正的拦截接口</span><br>        registry.addInterceptor(loginInterceptor)<br>                .addPathPatterns(<span class="hljs-string">&quot;/test&quot;</span>)<br>                .addPathPatterns(<span class="hljs-string">&quot;/comments/create/change&quot;</span>)<br>                .addPathPatterns(<span class="hljs-string">&quot;/articles/publish&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225204254472.png" srcset="/img/loading.gif" lazyload alt="image-20221225204254472"></p>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><h5 id="uploadController"><a href="#uploadController" class="headerlink" title="uploadController"></a>uploadController</h5><p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225204825402.png" srcset="/img/loading.gif" lazyload alt="image-20221225204825402"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.controller;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.QiniuUtils;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> com.qiniu.common.QiniuException;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;upload&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UploadController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> QiniuUtils qiniuUtils;<br><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;image&quot;)</span> MultipartFile file)</span>&#123;<br>        <span class="hljs-comment">//原始文件名称 比如 aa.png</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>        <span class="hljs-comment">//唯一的文件名称</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + <span class="hljs-string">&quot;.&quot;</span> + StringUtils.substringAfterLast(originalFilename, <span class="hljs-string">&quot;.&quot;</span>);<br>        <span class="hljs-comment">//上传文件 上传到哪呢？ 七牛云 云服务器 按量付费 速度快 把图片发放到离用户最近的服务器上</span><br>        <span class="hljs-comment">// 降低 我们自身应用服务器的带宽消耗</span><br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">upload</span> <span class="hljs-operator">=</span> qiniuUtils.upload(file, fileName);<br>        <span class="hljs-keyword">if</span> (upload)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(QiniuUtils.url + fileName);<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-number">20001</span>,<span class="hljs-string">&quot;上传失败&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">deleteFile</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            qiniuUtils.deleteAll();<br>        &#125; <span class="hljs-keyword">catch</span> (QiniuException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h5 id="Usercontroller"><a href="#Usercontroller" class="headerlink" title="Usercontroller"></a>Usercontroller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.controller;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.service.SysUserService;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysUserService sysUserService;<br><br>    <span class="hljs-comment">///users/currentUser</span><br>    <span class="hljs-meta">@GetMapping(&quot;currentUser&quot;)</span>  <span class="hljs-comment">//头文件</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">currentUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader(&quot;Authorization&quot;)</span> String token)</span>&#123;<br>        <span class="hljs-keyword">return</span> sysUserService.findUserByToken(token);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h4><h5 id="AllExceptionHandler"><a href="#AllExceptionHandler" class="headerlink" title="AllExceptionHandler"></a>AllExceptionHandler</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.handler;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-comment">//对加了@Controller注解的方法进行拦截处理 AOP的实现</span><br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AllExceptionHandler</span> &#123;<br>    <span class="hljs-comment">//进行异常处理，处理Exception.class的异常</span><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseBody</span> <span class="hljs-comment">//返回json数据</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doException</span><span class="hljs-params">(Exception ex)</span>&#123;<br>        ex.printStackTrace();<br>        <span class="hljs-keyword">return</span> Result.fail(-<span class="hljs-number">999</span>,<span class="hljs-string">&quot;系统异常&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="LoginInterceptor"><a href="#LoginInterceptor" class="headerlink" title="LoginInterceptor"></a>LoginInterceptor</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.handler;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.SysUser;<br><span class="hljs-keyword">import</span> com.mszlu.blog.service.LoginService;<br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.UserThreadLocal;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.ErrorCode;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.method.HandlerMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> LoginService loginService;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//在执行controller方法(Handler)之前进行执行</span><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1. 需要判断 请求的接口路径 是否为 HandlerMethod (controller方法)</span><br><span class="hljs-comment">         * 2. 判断 token是否为空，如果为空 未登录</span><br><span class="hljs-comment">         * 3. 如果token 不为空，登录验证 loginService checkToken</span><br><span class="hljs-comment">         * 4. 如果认证成功 放行即可</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">if</span> (!(handler <span class="hljs-keyword">instanceof</span> HandlerMethod))&#123;<br>            <span class="hljs-comment">//handler 可能是 RequestResourceHandler springboot 程序 访问静态资源 默认去classpath下的static目录去查询</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;Authorization&quot;</span>);<br><br>        log.info(<span class="hljs-string">&quot;=================request start===========================&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        log.info(<span class="hljs-string">&quot;request uri:&#123;&#125;&quot;</span>,requestURI);<br>        log.info(<span class="hljs-string">&quot;request method:&#123;&#125;&quot;</span>,request.getMethod());<br>        log.info(<span class="hljs-string">&quot;token:&#123;&#125;&quot;</span>, token);<br>        log.info(<span class="hljs-string">&quot;=================request end===========================&quot;</span>);<br><br><br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(token))&#123;<br>            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Result.fail(ErrorCode.NO_LOGIN.getCode(), <span class="hljs-string">&quot;未登录&quot;</span>);<br>            response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);<br>            response.getWriter().print(JSON.toJSONString(result));<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span> loginService.checkToken(token);<br>        <span class="hljs-keyword">if</span> (sysUser == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Result.fail(ErrorCode.NO_LOGIN.getCode(), <span class="hljs-string">&quot;未登录&quot;</span>);<br>            response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);<br>            response.getWriter().print(JSON.toJSONString(result));<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">//登录验证成功，放行</span><br>        <span class="hljs-comment">//我希望在controller中 直接获取用户的信息 怎么获取?</span><br>        UserThreadLocal.put(sysUser);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//如果不删除 ThreadLocal中用完的信息 会有内存泄漏的风险</span><br>        UserThreadLocal.remove();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="ViewCountHandler"><a href="#ViewCountHandler" class="headerlink" title="ViewCountHandler"></a>ViewCountHandler</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.handler;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.mapper.ArticleMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.Article;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.joda.time.DateTime;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Async;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewCountHandler</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ArticleMapper articleMapper;<br><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0/10 * * * * *&quot;)</span><br>    <span class="hljs-comment">//@Scheduled(cron = &quot;0 0 3 * * *&quot;) 生产环境 每天凌晨3点执行</span><br>    <span class="hljs-meta">@Async(&quot;taskExecutor&quot;)</span> <span class="hljs-comment">//扔到线程池 执行</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduled</span><span class="hljs-params">()</span>&#123;<br>        log.info(<span class="hljs-string">&quot;=====&gt;&gt;&gt;&gt;&gt; 同步浏览量开始执行  &#123;&#125;&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTime</span>().toString(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));<br>        Map&lt;Object, Object&gt; countMap = redisTemplate.opsForHash().entries(<span class="hljs-string">&quot;view_count&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;Object,Object&gt; entry : countMap.entrySet())&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">articleId</span> <span class="hljs-operator">=</span> Long.parseLong(entry.getKey().toString());<br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> Integer.parseInt(entry.getValue().toString());<br>            <span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br>            article.setId(articleId);<br>            article.setViewCounts(count);<br>            articleMapper.updateById(article);<br>        &#125;<br>        log.info(<span class="hljs-string">&quot;=====&gt;&gt;&gt;&gt;&gt; 同步浏览量结束  &#123;&#125;&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTime</span>().toString(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><h5 id="LoginServiceImpl"><a href="#LoginServiceImpl" class="headerlink" title="LoginServiceImpl"></a>LoginServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.service.impl;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.SysUser;<br><span class="hljs-keyword">import</span> com.mszlu.blog.service.LoginService;<br><span class="hljs-keyword">import</span> com.mszlu.blog.service.SysUserService;<br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.JWTUtils;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.ErrorCode;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.params.LoginParam;<br><span class="hljs-keyword">import</span> org.apache.commons.codec.digest.DigestUtils;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LoginService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysUserService sysUserService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">slat</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mszlu!@#&quot;</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(LoginParam loginParam)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1. 检查参数是否合法</span><br><span class="hljs-comment">         * 2. 根据用户名和密码去user表中查询 是否存在</span><br><span class="hljs-comment">         * 3. 如果不存在 登录失败</span><br><span class="hljs-comment">         * 4. 如果存在 ，使用jwt 生成token 返回给前端</span><br><span class="hljs-comment">         * 5. token放入redis当中，redis  token：user信息 设置过期时间</span><br><span class="hljs-comment">         *  (登录认证的时候 先认证token字符串是否合法，去redis认证是否存在)</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> loginParam.getAccount();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> loginParam.getPassword();<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(account) || StringUtils.isBlank(password))&#123;<br>            <span class="hljs-keyword">return</span> Result.fail(ErrorCode.PARAMS_ERROR.getCode(),ErrorCode.PARAMS_ERROR.getMsg());<br>        &#125;<br>        password = DigestUtils.md5Hex(password + slat);<br>        <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span> sysUserService.findUser(account,password);<br>        <span class="hljs-keyword">if</span> (sysUser == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.fail(ErrorCode.ACCOUNT_PWD_NOT_EXIST.getCode(),ErrorCode.ACCOUNT_PWD_NOT_EXIST.getMsg());<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JWTUtils.createToken(sysUser.getId());<br><br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;TOKEN_&quot;</span>+token, JSON.toJSONString(sysUser),<span class="hljs-number">1</span>, TimeUnit.DAYS);<br>        <span class="hljs-keyword">return</span> Result.success(token);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SysUser <span class="hljs-title function_">checkToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(token))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        Map&lt;String, Object&gt; stringObjectMap = JWTUtils.checkToken(token);<br>        <span class="hljs-keyword">if</span> (stringObjectMap == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userJson</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;TOKEN_&quot;</span> + token);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(userJson))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span> JSON.parseObject(userJson, SysUser.class);<br>        <span class="hljs-keyword">return</span> sysUser;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">logout</span><span class="hljs-params">(String token)</span> &#123;<br>        redisTemplate.delete(<span class="hljs-string">&quot;TOKEN_&quot;</span>+token);<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">register</span><span class="hljs-params">(LoginParam loginParam)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1. 判断参数 是否合法</span><br><span class="hljs-comment">         * 2. 判断账户是否存在，存在 返回账户已经被注册</span><br><span class="hljs-comment">         * 3. 不存在，注册用户</span><br><span class="hljs-comment">         * 4. 生成token</span><br><span class="hljs-comment">         * 5. 存入redis 并返回</span><br><span class="hljs-comment">         * 6. 注意 加上事务，一旦中间的任何过程出现问题，注册的用户 需要回滚</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> loginParam.getAccount();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> loginParam.getPassword();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">nickname</span> <span class="hljs-operator">=</span> loginParam.getNickname();<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(account)<br>                || StringUtils.isBlank(password)<br>                || StringUtils.isBlank(nickname)<br>        )&#123;<br>            <span class="hljs-keyword">return</span> Result.fail(ErrorCode.PARAMS_ERROR.getCode(),ErrorCode.PARAMS_ERROR.getMsg());<br>        &#125;<br>        <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span>  sysUserService.findUserByAccount(account);<br>        <span class="hljs-keyword">if</span> (sysUser != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.fail(ErrorCode.ACCOUNT_EXIST.getCode(),<span class="hljs-string">&quot;账户已经被注册了&quot;</span>);<br>        &#125;<br>        sysUser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysUser</span>();<br>        sysUser.setNickname(nickname);<br>        sysUser.setAccount(account);<br>        sysUser.setPassword(DigestUtils.md5Hex(password+slat));<br>        sysUser.setCreateDate(System.currentTimeMillis());<br>        sysUser.setLastLogin(System.currentTimeMillis());<br>        sysUser.setAvatar(<span class="hljs-string">&quot;/static/img/logo.b3a48c0.png&quot;</span>);<br>        sysUser.setAdmin(<span class="hljs-number">1</span>); <span class="hljs-comment">//1 为true</span><br>        sysUser.setDeleted(<span class="hljs-number">0</span>); <span class="hljs-comment">// 0 为false</span><br>        sysUser.setSalt(<span class="hljs-string">&quot;&quot;</span>);<br>        sysUser.setStatus(<span class="hljs-string">&quot;&quot;</span>);<br>        sysUser.setEmail(<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-built_in">this</span>.sysUserService.save(sysUser);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JWTUtils.createToken(sysUser.getId());<br><br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;TOKEN_&quot;</span>+token, JSON.toJSONString(sysUser),<span class="hljs-number">1</span>, TimeUnit.DAYS);<br>        <span class="hljs-keyword">return</span> Result.success(token);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="CommentsServiceImpl"><a href="#CommentsServiceImpl" class="headerlink" title="CommentsServiceImpl"></a>CommentsServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Wrappers;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.mapper.ArticleMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.mapper.CommentMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.Article;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.Comment;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.SysUser;<br><span class="hljs-keyword">import</span> com.mszlu.blog.service.CommentsService;<br><span class="hljs-keyword">import</span> com.mszlu.blog.service.SysUserService;<br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.UserThreadLocal;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.CommentVo;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.Result;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.UserVo;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.params.CommentParam;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommentsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommentsService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CommentMapper commentMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysUserService sysUserService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ArticleMapper articleMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">commentsByArticleId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1. 根据文章id 查询 评论列表 从 comment 表中查询</span><br><span class="hljs-comment">         * 2. 根据作者的id 查询作者的信息</span><br><span class="hljs-comment">         * 3. 判断 如果 level = 1 要去查询它有没有子评论</span><br><span class="hljs-comment">         * 4. 如果有 根据评论id 进行查询 （parent_id）</span><br><span class="hljs-comment">         */</span><br>        LambdaQueryWrapper&lt;Comment&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(Comment::getArticleId,id);<br>        queryWrapper.eq(Comment::getLevel,<span class="hljs-number">1</span>);<br>        queryWrapper.orderByDesc(Comment::getCreateDate);<br>        List&lt;Comment&gt; comments = commentMapper.selectList(queryWrapper);<br>        List&lt;CommentVo&gt; commentVoList = copyList(comments);<br>        <span class="hljs-keyword">return</span> Result.success(commentVoList);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">comment</span><span class="hljs-params">(CommentParam commentParam)</span> &#123;<br><span class="hljs-comment">//        拦截</span><br>        <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span> UserThreadLocal.get();<br>        <span class="hljs-type">Comment</span> <span class="hljs-variable">comment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comment</span>();<br>        comment.setArticleId(commentParam.getArticleId());<br>        comment.setAuthorId(sysUser.getId());<br>        comment.setContent(commentParam.getContent());<br>        comment.setCreateDate(System.currentTimeMillis());<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> commentParam.getParent();<br>        <span class="hljs-keyword">if</span> (parent == <span class="hljs-literal">null</span> || parent == <span class="hljs-number">0</span>) &#123;<br>            comment.setLevel(<span class="hljs-number">1</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            comment.setLevel(<span class="hljs-number">2</span>);<br>        &#125;<br>        comment.setParentId(parent == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : parent);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">toUserId</span> <span class="hljs-operator">=</span> commentParam.getToUserId();<br>        comment.setToUid(toUserId == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : toUserId);<br>        <span class="hljs-built_in">this</span>.commentMapper.insert(comment);<br>        UpdateWrapper&lt;Article&gt; updateWrapper = Wrappers.update();<br>        updateWrapper.eq(<span class="hljs-string">&quot;id&quot;</span>,comment.getArticleId());<br>        updateWrapper.setSql(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;comment_counts=comment_counts+1&quot;</span>);<br>        <span class="hljs-built_in">this</span>.articleMapper.update(<span class="hljs-literal">null</span>,updateWrapper);<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> List&lt;CommentVo&gt; <span class="hljs-title function_">copyList</span><span class="hljs-params">(List&lt;Comment&gt; comments)</span> &#123;<br>        List&lt;CommentVo&gt; commentVoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Comment comment : comments) &#123;<br>            commentVoList.add(copy(comment));<br>        &#125;<br>        <span class="hljs-keyword">return</span> commentVoList;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> CommentVo <span class="hljs-title function_">copy</span><span class="hljs-params">(Comment comment)</span> &#123;<br>        <span class="hljs-type">CommentVo</span> <span class="hljs-variable">commentVo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommentVo</span>();<br>        BeanUtils.copyProperties(comment,commentVo);<br>        commentVo.setId(String.valueOf(comment.getId()));<br>        <span class="hljs-comment">//作者信息</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">authorId</span> <span class="hljs-operator">=</span> comment.getAuthorId();<br>        <span class="hljs-type">UserVo</span> <span class="hljs-variable">userVo</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.sysUserService.findUserVoById(authorId);<br>        commentVo.setAuthor(userVo);<br>        <span class="hljs-comment">//子评论</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> comment.getLevel();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == level)&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> comment.getId();<br>            List&lt;CommentVo&gt; commentVoList = findCommentsByParentId(id);<br>            commentVo.setChildrens(commentVoList);<br>        &#125;<br>        <span class="hljs-comment">//to User 给谁评论</span><br>        <span class="hljs-keyword">if</span> (level &gt; <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">toUid</span> <span class="hljs-operator">=</span> comment.getToUid();<br>            <span class="hljs-type">UserVo</span> <span class="hljs-variable">toUserVo</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.sysUserService.findUserVoById(toUid);<br>            commentVo.setToUser(toUserVo);<br>        &#125;<br>        <span class="hljs-keyword">return</span> commentVo;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> List&lt;CommentVo&gt; <span class="hljs-title function_">findCommentsByParentId</span><span class="hljs-params">(Long id)</span> &#123;<br>        LambdaQueryWrapper&lt;Comment&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(Comment::getParentId,id);<br>        queryWrapper.eq(Comment::getLevel,<span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">return</span> copyList(commentMapper.selectList(queryWrapper));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="ArticleServiceImpl"><a href="#ArticleServiceImpl" class="headerlink" title="ArticleServiceImpl"></a>ArticleServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Wrappers;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.dos.Archives;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.mapper.ArticleBodyMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.mapper.ArticleMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.mapper.ArticleTagMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.Article;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.ArticleBody;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.ArticleTag;<br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.SysUser;<br><span class="hljs-keyword">import</span> com.mszlu.blog.service.*;<br><span class="hljs-keyword">import</span> com.mszlu.blog.utils.UserThreadLocal;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.*;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.params.ArticleParam;<br><span class="hljs-keyword">import</span> com.mszlu.blog.vo.params.PageParams;<br><span class="hljs-keyword">import</span> org.joda.time.DateTime;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ArticleService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ArticleMapper articleMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TagService tagService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysUserService sysUserService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ArticleTagMapper articleTagMapper;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">listArticle</span><span class="hljs-params">(PageParams pageParams)</span> &#123;<br>        Page&lt;Article&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageParams.getPage(),pageParams.getPageSize());<br><br>        IPage&lt;Article&gt; articleIPage = articleMapper.listArticle(<br>                page,<br>                pageParams.getCategoryId(),<br>                pageParams.getTagId(),<br>                pageParams.getYear(),<br>                pageParams.getMonth());<br>        List&lt;Article&gt; records = articleIPage.getRecords();<br>        <span class="hljs-keyword">for</span> (Article record : records) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">viewCount</span> <span class="hljs-operator">=</span> (String) redisTemplate.opsForHash().get(<span class="hljs-string">&quot;view_count&quot;</span>, String.valueOf(record.getId()));<br>            <span class="hljs-keyword">if</span> (viewCount != <span class="hljs-literal">null</span>)&#123;<br>                record.setViewCounts(Integer.parseInt(viewCount));<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.success(copyList(records,<span class="hljs-literal">true</span>,<span class="hljs-literal">true</span>));<br>    &#125;<br><br><span class="hljs-comment">//    @Override</span><br><span class="hljs-comment">//    public Result listArticle(PageParams pageParams) &#123;</span><br><span class="hljs-comment">//        /**</span><br><span class="hljs-comment">//         * 1. 分页查询 article数据库表</span><br><span class="hljs-comment">//         */</span><br><span class="hljs-comment">//        Page&lt;Article&gt; page = new Page&lt;&gt;(pageParams.getPage(),pageParams.getPageSize());</span><br><span class="hljs-comment">//        LambdaQueryWrapper&lt;Article&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="hljs-comment">//        if (pageParams.getCategoryId() != null)&#123;</span><br><span class="hljs-comment">//            // and category_id=#&#123;categoryId&#125;</span><br><span class="hljs-comment">//            queryWrapper.eq(Article::getCategoryId,pageParams.getCategoryId());</span><br><span class="hljs-comment">//        &#125;</span><br><span class="hljs-comment">//        List&lt;Long&gt; articleIdList = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        if (pageParams.getTagId() != null)&#123;</span><br><span class="hljs-comment">//            //加入标签 条件查询</span><br><span class="hljs-comment">//            //article表中 并没有tag字段 一篇文章 有多个标签</span><br><span class="hljs-comment">//            //article_tag  article_id 1 : n tag_id</span><br><span class="hljs-comment">//            LambdaQueryWrapper&lt;ArticleTag&gt; articleTagLambdaQueryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="hljs-comment">//            articleTagLambdaQueryWrapper.eq(ArticleTag::getTagId,pageParams.getTagId());</span><br><span class="hljs-comment">//            List&lt;ArticleTag&gt; articleTags = articleTagMapper.selectList(articleTagLambdaQueryWrapper);</span><br><span class="hljs-comment">//            for (ArticleTag articleTag : articleTags) &#123;</span><br><span class="hljs-comment">//                articleIdList.add(articleTag.getArticleId());</span><br><span class="hljs-comment">//            &#125;</span><br><span class="hljs-comment">//            if (articleIdList.size() &gt; 0)&#123;</span><br><span class="hljs-comment">//                // and id in(1,2,3)</span><br><span class="hljs-comment">//                queryWrapper.in(Article::getId,articleIdList);</span><br><span class="hljs-comment">//            &#125;</span><br><span class="hljs-comment">//        &#125;</span><br><span class="hljs-comment">//        //是否置顶进行排序</span><br><span class="hljs-comment">//        //order by create_date desc</span><br><span class="hljs-comment">//        queryWrapper.orderByDesc(Article::getWeight,Article::getCreateDate);</span><br><span class="hljs-comment">//        Page&lt;Article&gt; articlePage = articleMapper.selectPage(page, queryWrapper);</span><br><span class="hljs-comment">//        List&lt;Article&gt; records = articlePage.getRecords();</span><br><span class="hljs-comment">//        //能直接返回吗？ 很明显不能</span><br><span class="hljs-comment">//        List&lt;ArticleVo&gt; articleVoList = copyList(records,true,true);</span><br><span class="hljs-comment">//        return Result.success(articleVoList);</span><br><span class="hljs-comment">//    &#125;</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">hotArticle</span><span class="hljs-params">(<span class="hljs-type">int</span> limit)</span> &#123;<br>        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.orderByDesc(Article::getViewCounts);<br>        queryWrapper.select(Article::getId,Article::getTitle);<br>        queryWrapper.last(<span class="hljs-string">&quot;limit &quot;</span>+limit);<br>        <span class="hljs-comment">//select id,title from article order by view_counts desc limit 5</span><br>        List&lt;Article&gt; articles = articleMapper.selectList(queryWrapper);<br><br>        <span class="hljs-keyword">return</span> Result.success(copyList(articles,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">newArticles</span><span class="hljs-params">(<span class="hljs-type">int</span> limit)</span> &#123;<br>        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.orderByDesc(Article::getCreateDate);<br>        queryWrapper.select(Article::getId,Article::getTitle);<br>        queryWrapper.last(<span class="hljs-string">&quot;limit &quot;</span>+limit);<br>        <span class="hljs-comment">//select id,title from article order by create_date desc desc limit 5</span><br>        List&lt;Article&gt; articles = articleMapper.selectList(queryWrapper);<br><br>        <span class="hljs-keyword">return</span> Result.success(copyList(articles,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">listArchives</span><span class="hljs-params">()</span> &#123;<br>        List&lt;Archives&gt; archivesList = articleMapper.listArchives();<br>        <span class="hljs-keyword">return</span> Result.success(archivesList);<br>    &#125;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ThreadService threadService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;<br><span class="hljs-comment">//    @Autowired</span><br><span class="hljs-comment">//    private RocketMQTemplate rocketMQTemplate;</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">findArticleById</span><span class="hljs-params">(Long articleId)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1. 根据id查询 文章信息</span><br><span class="hljs-comment">         * 2. 根据bodyId和categoryid 去做关联查询</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.articleMapper.selectById(articleId);<br>        <span class="hljs-type">ArticleVo</span> <span class="hljs-variable">articleVo</span> <span class="hljs-operator">=</span> copy(article, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>,<span class="hljs-literal">true</span>,<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//查看完文章了，新增阅读数，有没有问题呢？</span><br>        <span class="hljs-comment">//查看完文章之后，本应该直接返回数据了，这时候做了一个更新操作，更新时加写锁，阻塞其他的读操作，性能就会比较低</span><br>        <span class="hljs-comment">// 更新 增加了此次接口的 耗时 如果一旦更新出问题，不能影响 查看文章的操作</span><br>        <span class="hljs-comment">//线程池  可以把更新操作 扔到线程池中去执行，和主线程就不相关了</span><br>        threadService.updateArticleViewCount(articleMapper,article);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">viewCount</span> <span class="hljs-operator">=</span> (String) redisTemplate.opsForHash().get(<span class="hljs-string">&quot;view_count&quot;</span>, String.valueOf(articleId));<br>        <span class="hljs-keyword">if</span> (viewCount != <span class="hljs-literal">null</span>)&#123;<br>            articleVo.setViewCounts(Integer.parseInt(viewCount));<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.success(articleVo);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">publish</span><span class="hljs-params">(ArticleParam articleParam)</span> &#123;<br>        <span class="hljs-comment">//此接口 要加入到登录拦截当中</span><br>        <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span> UserThreadLocal.get();<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1. 发布文章 目的 构建Article对象</span><br><span class="hljs-comment">         * 2. 作者id  当前的登录用户</span><br><span class="hljs-comment">         * 3. 标签  要将标签加入到 关联列表当中</span><br><span class="hljs-comment">         * 4. body 内容存储 article bodyId</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isEdit</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">if</span> (articleParam.getId() != <span class="hljs-literal">null</span>)&#123;<br>            article = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br>            article.setId(articleParam.getId());<br>            article.setTitle(articleParam.getTitle());<br>            article.setSummary(articleParam.getSummary());<br>            article.setCategoryId(Long.parseLong(articleParam.getCategory().getId()));<br>            articleMapper.updateById(article);<br>            isEdit = <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            article = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br>            article.setAuthorId(sysUser.getId());<br>            article.setWeight(Article.Article_Common);<br>            article.setViewCounts(<span class="hljs-number">0</span>);<br>            article.setTitle(articleParam.getTitle());<br>            article.setSummary(articleParam.getSummary());<br>            article.setCommentCounts(<span class="hljs-number">0</span>);<br>            article.setCreateDate(System.currentTimeMillis());<br>            article.setCategoryId(Long.parseLong(articleParam.getCategory().getId()));<br>            <span class="hljs-comment">//插入之后 会生成一个文章id</span><br>            <span class="hljs-built_in">this</span>.articleMapper.insert(article);<br>        &#125;<br>        <span class="hljs-comment">//tag</span><br>        List&lt;TagVo&gt; tags = articleParam.getTags();<br>        <span class="hljs-keyword">if</span> (tags != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">for</span> (TagVo tag : tags) &#123;<br>                <span class="hljs-type">Long</span> <span class="hljs-variable">articleId</span> <span class="hljs-operator">=</span> article.getId();<br>                <span class="hljs-keyword">if</span> (isEdit)&#123;<br>                    <span class="hljs-comment">//先删除</span><br>                    LambdaQueryWrapper&lt;ArticleTag&gt; queryWrapper = Wrappers.lambdaQuery();<br>                    queryWrapper.eq(ArticleTag::getArticleId,articleId);<br>                    articleTagMapper.delete(queryWrapper);<br>                &#125;<br>                <span class="hljs-type">ArticleTag</span> <span class="hljs-variable">articleTag</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleTag</span>();<br>                articleTag.setTagId(Long.parseLong(tag.getId()));<br>                articleTag.setArticleId(articleId);<br>                articleTagMapper.insert(articleTag);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//body</span><br>        <span class="hljs-keyword">if</span> (isEdit)&#123;<br>            <span class="hljs-type">ArticleBody</span> <span class="hljs-variable">articleBody</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleBody</span>();<br>            articleBody.setArticleId(article.getId());<br>            articleBody.setContent(articleParam.getBody().getContent());<br>            articleBody.setContentHtml(articleParam.getBody().getContentHtml());<br>            LambdaUpdateWrapper&lt;ArticleBody&gt; updateWrapper = Wrappers.lambdaUpdate();<br>            updateWrapper.eq(ArticleBody::getArticleId,article.getId());<br>            articleBodyMapper.update(articleBody, updateWrapper);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">ArticleBody</span> <span class="hljs-variable">articleBody</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleBody</span>();<br>            articleBody.setArticleId(article.getId());<br>            articleBody.setContent(articleParam.getBody().getContent());<br>            articleBody.setContentHtml(articleParam.getBody().getContentHtml());<br>            articleBodyMapper.insert(articleBody);<br><br>            article.setBodyId(articleBody.getId());<br>            articleMapper.updateById(article);<br>        &#125;<br>        Map&lt;String,String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;id&quot;</span>,article.getId().toString());<br><br>        <span class="hljs-keyword">if</span> (isEdit)&#123;<br>            <span class="hljs-comment">//发送一条消息给rocketmq 当前文章更新了，更新一下缓存吧</span><br>            <span class="hljs-type">ArticleMessage</span> <span class="hljs-variable">articleMessage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleMessage</span>();<br>            articleMessage.setArticleId(article.getId());<br><span class="hljs-comment">//            rocketMQTemplate.convertAndSend(&quot;blog-update-article&quot;,articleMessage);</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.success(map);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">searchArticle</span><span class="hljs-params">(String search)</span> &#123;<br>        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.orderByDesc(Article::getViewCounts);<br>        queryWrapper.select(Article::getId,Article::getTitle);<br>        queryWrapper.like(Article::getTitle,search);<br>        <span class="hljs-comment">//select id,title from article order by view_counts desc limit 5</span><br>        List&lt;Article&gt; articles = articleMapper.selectList(queryWrapper);<br><br>        <span class="hljs-keyword">return</span> Result.success(copyList(articles,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>));<br>    &#125;<br><br><br>    <span class="hljs-keyword">private</span> List&lt;ArticleVo&gt; <span class="hljs-title function_">copyList</span><span class="hljs-params">(List&lt;Article&gt; records, <span class="hljs-type">boolean</span> isTag, <span class="hljs-type">boolean</span> isAuthor)</span> &#123;<br>        List&lt;ArticleVo&gt; articleVoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Article record : records) &#123;<br>            articleVoList.add(copy(record,isTag,isAuthor,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>));<br>        &#125;<br>        <span class="hljs-keyword">return</span> articleVoList;<br>    &#125;<br>    <span class="hljs-keyword">private</span> List&lt;ArticleVo&gt; <span class="hljs-title function_">copyList</span><span class="hljs-params">(List&lt;Article&gt; records, <span class="hljs-type">boolean</span> isTag, <span class="hljs-type">boolean</span> isAuthor, <span class="hljs-type">boolean</span> isBody,<span class="hljs-type">boolean</span> isCategory)</span> &#123;<br>        List&lt;ArticleVo&gt; articleVoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Article record : records) &#123;<br>            articleVoList.add(copy(record,isTag,isAuthor,isBody,isCategory));<br>        &#125;<br>        <span class="hljs-keyword">return</span> articleVoList;<br>    &#125;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CategoryService categoryService;<br><br><br>    <span class="hljs-keyword">private</span> ArticleVo <span class="hljs-title function_">copy</span><span class="hljs-params">(Article article, <span class="hljs-type">boolean</span> isTag, <span class="hljs-type">boolean</span> isAuthor, <span class="hljs-type">boolean</span> isBody,<span class="hljs-type">boolean</span> isCategory)</span>&#123;<br>        <span class="hljs-type">ArticleVo</span> <span class="hljs-variable">articleVo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleVo</span>();<br>        articleVo.setId(String.valueOf(article.getId()));<br>        BeanUtils.copyProperties(article,articleVo);<br><br>        articleVo.setCreateDate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTime</span>(article.getCreateDate()).toString(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm&quot;</span>));<br>        <span class="hljs-comment">//并不是所有的接口 都需要标签 ，作者信息</span><br>        <span class="hljs-keyword">if</span> (isTag)&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">articleId</span> <span class="hljs-operator">=</span> article.getId();<br>            articleVo.setTags(tagService.findTagsByArticleId(articleId));<br>        &#125;<br>        <span class="hljs-keyword">if</span> (isAuthor)&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">authorId</span> <span class="hljs-operator">=</span> article.getAuthorId();<br>            <span class="hljs-type">SysUser</span> <span class="hljs-variable">sysUser</span> <span class="hljs-operator">=</span> sysUserService.findUserById(authorId);<br>            <span class="hljs-type">UserVo</span> <span class="hljs-variable">userVo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVo</span>();<br>            userVo.setAvatar(sysUser.getAvatar());<br>            userVo.setId(sysUser.getId().toString());<br>            userVo.setNickname(sysUser.getNickname());<br>            articleVo.setAuthor(userVo);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (isBody)&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">bodyId</span> <span class="hljs-operator">=</span> article.getBodyId();<br>            articleVo.setBody(findArticleBodyById(bodyId));<br>        &#125;<br>        <span class="hljs-keyword">if</span> (isCategory)&#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> article.getCategoryId();<br>            articleVo.setCategory(categoryService.findCategoryById(categoryId));<br>        &#125;<br>        <span class="hljs-keyword">return</span> articleVo;<br>    &#125;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ArticleBodyMapper articleBodyMapper;<br><br>    <span class="hljs-keyword">private</span> ArticleBodyVo <span class="hljs-title function_">findArticleBodyById</span><span class="hljs-params">(Long bodyId)</span> &#123;<br>        <span class="hljs-type">ArticleBody</span> <span class="hljs-variable">articleBody</span> <span class="hljs-operator">=</span> articleBodyMapper.selectById(bodyId);<br>        <span class="hljs-type">ArticleBodyVo</span> <span class="hljs-variable">articleBodyVo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleBodyVo</span>();<br>        articleBodyVo.setContent(articleBody.getContent());<br>        <span class="hljs-keyword">return</span> articleBodyVo;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225210844864-16719737263501.png" srcset="/img/loading.gif" lazyload alt="image-20221225210844864"></p>
<h4 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h4><h5 id="HttpContextUtils"><a href="#HttpContextUtils" class="headerlink" title="HttpContextUtils"></a>HttpContextUtils</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.utils;<br><br><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * HttpServletRequest</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpContextUtils</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HttpServletRequest <span class="hljs-title function_">getHttpServletRequest</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="IpUtils"><a href="#IpUtils" class="headerlink" title="IpUtils"></a>IpUtils</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.utils;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 获取Ip</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IpUtils</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取IP地址</span><br><span class="hljs-comment">     * &lt;p&gt;</span><br><span class="hljs-comment">     * 使用Nginx等反向代理软件， 则不能通过request.getRemoteAddr()获取IP地址</span><br><span class="hljs-comment">     * 如果使用了多级反向代理的话，X-Forwarded-For的值并不止一个，而是一串IP地址，X-Forwarded-For中第一个非unknown的有效IP字符串，则为真实IP地址</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getIpAddr</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>, unknown = <span class="hljs-string">&quot;unknown&quot;</span>, seperator = <span class="hljs-string">&quot;,&quot;</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxLength</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ip = request.getHeader(<span class="hljs-string">&quot;x-forwarded-for&quot;</span>);<br>            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(ip) || unknown.equalsIgnoreCase(ip)) &#123;<br>                ip = request.getHeader(<span class="hljs-string">&quot;Proxy-Client-IP&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(ip) || ip.length() == <span class="hljs-number">0</span> || unknown.equalsIgnoreCase(ip)) &#123;<br>                ip = request.getHeader(<span class="hljs-string">&quot;WL-Proxy-Client-IP&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(ip) || unknown.equalsIgnoreCase(ip)) &#123;<br>                ip = request.getHeader(<span class="hljs-string">&quot;HTTP_CLIENT_IP&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(ip) || unknown.equalsIgnoreCase(ip)) &#123;<br>                ip = request.getHeader(<span class="hljs-string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(ip) || unknown.equalsIgnoreCase(ip)) &#123;<br>                ip = request.getRemoteAddr();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;IpUtils ERROR &quot;</span>, e);<br>        &#125;<br><br>        <span class="hljs-comment">// 使用代理，则获取第一个IP地址</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(ip) &amp;&amp; ip.length() &gt; maxLength) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> ip.indexOf(seperator);<br>            <span class="hljs-keyword">if</span> (idx &gt; <span class="hljs-number">0</span>) &#123;<br>                ip = ip.substring(<span class="hljs-number">0</span>, idx);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> ip;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取ip地址</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getIpAddr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpContextUtils.getHttpServletRequest();<br>        <span class="hljs-keyword">return</span> getIpAddr(request);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="JWTUtils"><a href="#JWTUtils" class="headerlink" title="JWTUtils"></a>JWTUtils</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.utils;<br><br><span class="hljs-keyword">import</span> io.jsonwebtoken.Jwt;<br><span class="hljs-keyword">import</span> io.jsonwebtoken.JwtBuilder;<br><span class="hljs-keyword">import</span> io.jsonwebtoken.Jwts;<br><span class="hljs-keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;<br><span class="hljs-keyword">import</span> org.jasypt.util.text.BasicTextEncryptor;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JWTUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">jwtToken</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456Mszlu!@#$$&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">(Long userId)</span>&#123;<br>        Map&lt;String,Object&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        claims.put(<span class="hljs-string">&quot;userId&quot;</span>,userId);<br>        <span class="hljs-type">JwtBuilder</span> <span class="hljs-variable">jwtBuilder</span> <span class="hljs-operator">=</span> Jwts.builder()<br>                .signWith(SignatureAlgorithm.HS256, jwtToken) <span class="hljs-comment">// 签发算法，秘钥为jwtToken</span><br>                .setClaims(claims) <span class="hljs-comment">// body数据，要唯一，自行设置</span><br>                .setIssuedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) <span class="hljs-comment">// 设置签发时间</span><br>                .setExpiration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>));<span class="hljs-comment">// 一天的有效时间</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> jwtBuilder.compact();<br>        <span class="hljs-keyword">return</span> token;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; <span class="hljs-title function_">checkToken</span><span class="hljs-params">(String token)</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Jwt</span> <span class="hljs-variable">parse</span> <span class="hljs-operator">=</span> Jwts.parser().setSigningKey(jwtToken).parse(token);<br>            <span class="hljs-keyword">return</span> (Map&lt;String, Object&gt;) parse.getBody();<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">BasicTextEncryptor</span> <span class="hljs-variable">textEncryptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicTextEncryptor</span>();<br>        <span class="hljs-comment">//加密所需的salt</span><br>        textEncryptor.setPassword(<span class="hljs-string">&quot;mszlu_blog_$#@wzb_&amp;^%$#&quot;</span>);<br>        <span class="hljs-comment">//要加密的数据（数据库的用户名或密码）</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> textEncryptor.encrypt(<span class="hljs-string">&quot;root&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> textEncryptor.encrypt(<span class="hljs-string">&quot;root&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;username:&quot;</span>+username);<br>        System.out.println(<span class="hljs-string">&quot;password:&quot;</span>+password);<br>        System.out.println(textEncryptor.decrypt(<span class="hljs-string">&quot;29cZ+X9cNmECjbLXT2P/BBZWReVl30NS&quot;</span>));<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="QiniuUtils"><a href="#QiniuUtils" class="headerlink" title="QiniuUtils"></a>QiniuUtils</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.utils;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.qiniu.common.QiniuException;<br><span class="hljs-keyword">import</span> com.qiniu.http.Response;<br><span class="hljs-keyword">import</span> com.qiniu.storage.BucketManager;<br><span class="hljs-keyword">import</span> com.qiniu.storage.Configuration;<br><span class="hljs-keyword">import</span> com.qiniu.storage.Region;<br><span class="hljs-keyword">import</span> com.qiniu.storage.UploadManager;<br><span class="hljs-keyword">import</span> com.qiniu.storage.model.DefaultPutRet;<br><span class="hljs-keyword">import</span> com.qiniu.storage.model.FileInfo;<br><span class="hljs-keyword">import</span> com.qiniu.storage.model.FileListing;<br><span class="hljs-keyword">import</span> com.qiniu.util.Auth;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QiniuUtils</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://static.mszlu.com/&quot;</span>;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;qiniu.accessKey&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span>  String accessKey;<br>    <span class="hljs-meta">@Value(&quot;$&#123;qiniu.accessSecretKey&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span>  String accessSecretKey;<br><br>    <span class="hljs-keyword">public</span>  <span class="hljs-type">boolean</span> <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file,String fileName)</span>&#123;<br><br>        <span class="hljs-comment">//构造一个带指定 Region 对象的配置类</span><br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">cfg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Region.huabei());<br>        <span class="hljs-comment">//...其他参数参考类注释</span><br>        <span class="hljs-type">UploadManager</span> <span class="hljs-variable">uploadManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UploadManager</span>(cfg);<br>        <span class="hljs-comment">//...生成上传凭证，然后准备上传</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">bucket</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mszlu&quot;</span>;<br>        <span class="hljs-comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">byte</span>[] uploadBytes = file.getBytes();<br>            <span class="hljs-type">Auth</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> Auth.create(accessKey, accessSecretKey);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">upToken</span> <span class="hljs-operator">=</span> auth.uploadToken(bucket);<br>                <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> uploadManager.put(uploadBytes, fileName, upToken);<br>                <span class="hljs-comment">//解析上传成功的结果</span><br>                <span class="hljs-type">DefaultPutRet</span> <span class="hljs-variable">putRet</span> <span class="hljs-operator">=</span> JSON.parseObject(response.bodyString(), DefaultPutRet.class);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>                ex.printStackTrace();<br>            &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteAll</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> QiniuException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">bucket</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;wwwmszlucom&quot;</span>;<br>        <span class="hljs-type">Auth</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> Auth.create(accessKey, accessSecretKey);<br>        <span class="hljs-comment">//构造一个带指定 Region 对象的配置类</span><br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">cfg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Region.huabei());<br>        <span class="hljs-type">BucketManager</span> <span class="hljs-variable">bucketManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BucketManager</span>(auth,cfg);<br>        <span class="hljs-type">FileListing</span> <span class="hljs-variable">fileListing</span> <span class="hljs-operator">=</span> bucketManager.listFiles(bucket, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">1000</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        FileInfo[] items = fileListing.items;<br>        <span class="hljs-keyword">for</span> (FileInfo info : items)&#123;<br><br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="UserThreadLocal"><a href="#UserThreadLocal" class="headerlink" title="UserThreadLocal"></a>UserThreadLocal</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.utils;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.dao.pojo.SysUser;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserThreadLocal</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">UserThreadLocal</span><span class="hljs-params">()</span>&#123;&#125;<br>    <span class="hljs-comment">//线程变量隔离</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;SysUser&gt; LOCAL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(SysUser sysUser)</span>&#123;<br>        LOCAL.set(sysUser);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SysUser <span class="hljs-title function_">get</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> LOCAL.get();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span>&#123;<br>        LOCAL.remove();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="vo"><a href="#vo" class="headerlink" title="vo"></a>vo</h4><h5 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.vo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> success;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;<br><br>    <span class="hljs-keyword">private</span> String msg;<br><br>    <span class="hljs-keyword">private</span> Object data;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">success</span><span class="hljs-params">(Object data)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-literal">true</span>,<span class="hljs-number">200</span>,<span class="hljs-string">&quot;success&quot;</span>,data);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">fail</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String msg)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-literal">false</span>,code,msg,<span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="ErrorCode"><a href="#ErrorCode" class="headerlink" title="ErrorCode"></a>ErrorCode</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.vo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span>  <span class="hljs-title class_">ErrorCode</span> &#123;<br><br>    PARAMS_ERROR(<span class="hljs-number">10001</span>,<span class="hljs-string">&quot;参数有误&quot;</span>),<br>    ACCOUNT_PWD_NOT_EXIST(<span class="hljs-number">10002</span>,<span class="hljs-string">&quot;用户名或密码不存在&quot;</span>),<br>    TOKEN_ERROR(<span class="hljs-number">10003</span>,<span class="hljs-string">&quot;token不合法&quot;</span>),<br>    ACCOUNT_EXIST(<span class="hljs-number">10004</span>,<span class="hljs-string">&quot;账号已存在&quot;</span>),<br>    NO_PERMISSION(<span class="hljs-number">70001</span>,<span class="hljs-string">&quot;无访问权限&quot;</span>),<br>    SESSION_TIME_OUT(<span class="hljs-number">90001</span>,<span class="hljs-string">&quot;会话超时&quot;</span>),<br>    NO_LOGIN(<span class="hljs-number">90002</span>,<span class="hljs-string">&quot;未登录&quot;</span>),;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;<br>    <span class="hljs-keyword">private</span> String msg;<br><br>    ErrorCode(<span class="hljs-type">int</span> code, String msg)&#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMsg</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMsg</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="blog-admin"><a href="#blog-admin" class="headerlink" title="blog-admin"></a>blog-admin</h3><h4 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;project xmlns=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br>         xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>         xsi:schemaLocation=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;<br>    &lt;parent&gt;<br>        &lt;artifactId&gt;blog-parent&lt;/artifactId&gt;<br>        &lt;groupId&gt;com.mszlu&lt;/groupId&gt;<br>        &lt;version&gt;<span class="hljs-number">1.0</span>-SNAPSHOT&lt;/version&gt;<br>    &lt;/parent&gt;<br>    &lt;modelVersion&gt;<span class="hljs-number">4.0</span><span class="hljs-number">.0</span>&lt;/modelVersion&gt;<br><br>    &lt;artifactId&gt;blog-admin&lt;/artifactId&gt;<br>    &lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;<br>            &lt;!-- 排除 默认使用的logback  --&gt;<br>            &lt;exclusions&gt;<br>                &lt;exclusion&gt;<br>                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>                    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;<br>                &lt;/exclusion&gt;<br>            &lt;/exclusions&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;!-- log4j2 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">1.2</span><span class="hljs-number">.76</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;mysql&lt;/groupId&gt;<br>            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;<br>            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;commons-collections&lt;/groupId&gt;<br>            &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">3.2</span><span class="hljs-number">.2</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;commons-codec&lt;/groupId&gt;<br>            &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;<br>            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">3.4</span><span class="hljs-number">.3</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;joda-time&lt;/groupId&gt;<br>            &lt;artifactId&gt;joda-time&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">2.10</span><span class="hljs-number">.10</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br><br>&lt;/project&gt;<br></code></pre></td></tr></table></figure>

<h4 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">server.port=<span class="hljs-number">8889</span><br>spring.application.name=mszlu_admin_blog<br><br>#数据库的配置<br># datasource<br>spring.datasource.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/blog?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimeZone=UTC</span><br>spring.datasource.username=root<br>spring.datasource.password=admin123<br>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver<br><br>#mybatis-plus<br>mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl<br>mybatis-plus.global-config.db-config.table-prefix=ms_<br><br></code></pre></td></tr></table></figure>

<h4 id="SecurityConfig"><a href="#SecurityConfig" class="headerlink" title="SecurityConfig"></a>SecurityConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.admin.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;<br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.WebSecurity;<br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;<br><span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> BCryptPasswordEncoder <span class="hljs-title function_">bCryptPasswordEncoder</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//加密策略 MD5 不安全 彩虹表  MD5 加盐</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">mszlu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(<span class="hljs-string">&quot;mszlu&quot;</span>);<br>        System.out.println(mszlu);<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-built_in">super</span>.configure(web);<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        http.authorizeRequests() <span class="hljs-comment">//开启登录认证</span><br><span class="hljs-comment">//                .antMatchers(&quot;/user/findAll&quot;).hasRole(&quot;admin&quot;) //访问接口需要admin的角色</span><br>                .antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/img/**&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/js/**&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/plugins/**&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).access(<span class="hljs-string">&quot;@authService.auth(request,authentication)&quot;</span>) <span class="hljs-comment">//自定义service 来去实现实时的权限认证</span><br>                .antMatchers(<span class="hljs-string">&quot;/pages/**&quot;</span>).authenticated()<br>                .and().formLogin()<br>                .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>) <span class="hljs-comment">//自定义的登录页面</span><br>                .loginProcessingUrl(<span class="hljs-string">&quot;/login&quot;</span>) <span class="hljs-comment">//登录处理接口</span><br>                .usernameParameter(<span class="hljs-string">&quot;username&quot;</span>) <span class="hljs-comment">//定义登录时的用户名的key 默认为username</span><br>                .passwordParameter(<span class="hljs-string">&quot;password&quot;</span>) <span class="hljs-comment">//定义登录时的密码key，默认是password</span><br>                .defaultSuccessUrl(<span class="hljs-string">&quot;/pages/main.html&quot;</span>)<br>                .failureUrl(<span class="hljs-string">&quot;/login.html&quot;</span>)<br>                .permitAll() <span class="hljs-comment">//通过 不拦截，更加前面配的路径决定，这是指和登录表单相关的接口 都通过</span><br>                .and().logout() <span class="hljs-comment">//退出登录配置</span><br>                .logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>) <span class="hljs-comment">//退出登录接口</span><br>                .logoutSuccessUrl(<span class="hljs-string">&quot;/login.html&quot;</span>)<br>                .permitAll() <span class="hljs-comment">//退出登录的接口放行</span><br>                .and()<br>                .httpBasic()<br>                .and()<br>                .csrf().disable() <span class="hljs-comment">//csrf关闭 如果自定义登录 需要关闭</span><br>                .headers().frameOptions().sameOrigin();<span class="hljs-comment">// 支持iframe页面嵌套</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225211811963.png" srcset="/img/loading.gif" lazyload alt="image-20221225211811963"></p>
<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225211918348.png" srcset="/img/loading.gif" lazyload alt="image-20221225211918348"></p>
<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225211937460.png" srcset="/img/loading.gif" lazyload alt="image-20221225211937460"></p>
<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225211950182-16719743913003.png" srcset="/img/loading.gif" lazyload alt="image-20221225211950182"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.admin.service;<br><br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.pojo.Admin;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.pojo.Permission;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.security.core.Authentication;<br><span class="hljs-keyword">import</span> org.springframework.security.core.GrantedAuthority;<br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AdminService adminService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">auth</span><span class="hljs-params">(HttpServletRequest request, Authentication authentication)</span>&#123;<br>        <span class="hljs-comment">//权限认证</span><br>        <span class="hljs-comment">//请求路径</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> authentication.getPrincipal();<br>        <span class="hljs-keyword">if</span> (principal == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;anonymousUser&quot;</span>.equals(principal))&#123;<br>            <span class="hljs-comment">//未登录</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> (UserDetails) principal;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> userDetails.getUsername();<br>        <span class="hljs-type">Admin</span> <span class="hljs-variable">admin</span> <span class="hljs-operator">=</span> adminService.findAdminByUsername(username);<br>        <span class="hljs-keyword">if</span> (admin == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span>  <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == admin.getId())&#123;<br>            <span class="hljs-comment">//超级管理员</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> admin.getId();<br>        List&lt;Permission&gt; permissionList = <span class="hljs-built_in">this</span>.adminService.findPermissionByAdminId(id);<br>        requestURI = StringUtils.split(requestURI,<span class="hljs-string">&#x27;?&#x27;</span>)[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span> (Permission permission : permissionList) &#123;<br>            <span class="hljs-keyword">if</span> (requestURI.equals(permission.getPath()))&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mszlu.blog.admin.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.controller.AdminController;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.mapper.PermissionMapper;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.model.params.PageParam;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.pojo.Permission;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.vo.PageResult;<br><span class="hljs-keyword">import</span> com.mszlu.blog.admin.vo.Result;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> sun.security.krb5.internal.PAData;<br><br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PermissionMapper permissionMapper;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">listPermission</span><span class="hljs-params">(PageParam pageParam)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 要的数据，管理台 表的所有的字段 Permission</span><br><span class="hljs-comment">         * 分页查询</span><br><span class="hljs-comment">         */</span><br>        Page&lt;Permission&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageParam.getCurrentPage(),pageParam.getPageSize());<br>        LambdaQueryWrapper&lt;Permission&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(pageParam.getQueryString()))&#123;<br>            queryWrapper.eq(Permission::getName,pageParam.getQueryString());<br>        &#125;<br>        Page&lt;Permission&gt; permissionPage = permissionMapper.selectPage(page, queryWrapper);<br>        PageResult&lt;Permission&gt; pageResult = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>&lt;&gt;();<br>        pageResult.setList(permissionPage.getRecords());<br>        pageResult.setTotal(permissionPage.getTotal());<br>        <span class="hljs-keyword">return</span> Result.success(pageResult);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">add</span><span class="hljs-params">(Permission permission)</span> &#123;<br>        <span class="hljs-built_in">this</span>.permissionMapper.insert(permission);<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(Permission permission)</span> &#123;<br>        <span class="hljs-built_in">this</span>.permissionMapper.updateById(permission);<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.permissionMapper.deleteById(id);<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225212226550.png" srcset="/img/loading.gif" lazyload alt="image-20221225212226550"></p>
<p><img src="/2022/12/25/%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93/image-20221225212241175-16719745618366.png" srcset="/img/loading.gif" lazyload alt="image-20221225212241175"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%80%BB%E7%BB%93/" class="category-chain-item">总结</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/SpringBoot/">#SpringBoot</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>码神之路博客总结(后端)</div>
      <div>http://example.com/2022/12/25/码神之路博客总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年12月25日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/01/11/SpringCloud-Eureka/" title="SpringCloud Eureka">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">SpringCloud Eureka</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/12/05/SpringBoot%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" title="SpringBoot定时任务">
                        <span class="hidden-mobile">SpringBoot定时任务</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
  
  <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
<script type="text/javascript" src="/js/fireworks.js"></script>
<script type="text/javascript" src="\js\snow.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>